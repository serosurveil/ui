<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Maps with Leaflet,TopoJSON & Chroma.js</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <style>
        * {
            margin: 0;
            padding: 0;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }

        body,
        html,
        #worldmap {
            height: 100%;
        }

        body {
            color: #333;
            font-family: sans-serif;
        }

        #worldmap {
            background: white;
        }

        .country-name {
            position: absolute;
            top: 2em;
            right: 1em;
            z-index: 6;
            background: rgba(0, 0, 0, .75);
            color: white;
            padding: .5em .75em;
            font-size: .85em;
            display: none;
        }
    </style>
</head>

<body>

    <div id="worldmap"></div>
    <div class="country-name"></div>
    <script type="text/javascript" src="./us-states.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/chroma-js/0.5.9/chroma.min.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
    <script>
        // Copyright (c) 2013 Ryan Clark
        // https://gist.github.com/rclark/5779673
        L.TopoJSON = L.GeoJSON.extend({
            addData: function (jsonData) {
                if (jsonData.type === "Topology") {
                    for (key in jsonData.objects) {
                        geojson = topojson.feature(jsonData, jsonData.objects[key]);
                        L.GeoJSON.prototype.addData.call(this, geojson);
                    }
                }
                else {
                    L.GeoJSON.prototype.addData.call(this, jsonData);
                }
            }
        });
    </script>
    <script>



        var map = L.map('worldmap', { maxZoom: 10, minZoom: 3, worldCopyJump: true }),
            topoLayer = new L.TopoJSON(),
            $countryName = $('.country-name'),
            colorScale = chroma
                .scale(['#D5E3FF', '#003171'])
                .domain([0, 1]);

        map.setView([44, -31], 3);

        $.getJSON('./countries.json').done(addTopoData);

        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1IjoicnVzc3dlYXMiLCJhIjoiY2t2enR3OW9kMHJycTJvbHRsaDhzbTR0YiJ9.8Z7T4nZIoITtv9_efsA4iw'
        }).addTo(map);
        var world;
        function addTopoData(topoData) {
            topoLayer.addData(topoData);
            world = topoLayer.addTo(map);
            topoLayer.eachLayer(handleLayer);
        }

        function rand_between(min, max) {
            return Math.floor(
                Math.random() * (max - min) + min
            )
        }

        function getColor(d) {
            return d > 1000 ? '#800026' :
                d > 500 ? '#BD0026' :
                    d > 200 ? '#E31A1C' :
                        d > 100 ? '#FC4E2A' :
                            d > 50 ? '#FD8D3C' :
                                d > 20 ? '#FEB24C' :
                                    d > 10 ? '#FED976' :
                                        '#FFEDA0';
        }

        function backToWorld() {
            world.addTo(map);
            map.removeLayer(states);
        }

        function style(feature) {
            return {
                weight: 2,
                opacity: .5,
                fillOpacity: 0.5,
                fillColor: getColor(feature.properties.density)
            };
        }

        var states;
        function regionClick(e) {
            map.fitBounds(e.target.getBounds());
            states = L.geoJson(statesData, {
                style: style,
                onEachFeature: onEachFeature
            });
            states.addTo(map);
            map.removeLayer(world);
            leaveCountry = "United States";
        }
        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: enterLayer,
                mouseout: leaveLayer,
                click: zoomToFeature
            });
        }
        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds());
        }
        function handleLayer(layer) {
            var randomValue = rand_between(1, 1100) * Math.random() * Math.random(),
                fillColor = getColor(randomValue);

            layer.setStyle({
                fillColor: fillColor,
                fillOpacity: 0.7,
                color: '#555',
                weight: 1,
                opacity: 0.5
            });

            layer.on({
                mouseover: enterLayer,
                mouseout: leaveLayer,
                click: regionClick
            });
        }
        leaveCountry = "";

        function enterLayer() {
            console.log(this.feature.properties)
            var countryName = this.feature.properties.name;
            $countryName.text(countryName).show();

            if (leaveCountry != "") {
                $countryName.html("<a onClick='backToWorld()' href='#'>Exit " + countryName + "</a>")
            }

            this.bringToFront();
            this.setStyle({
                weight: 2,
                opacity: 1
            });
        }
        function leaveLayer() {
            $countryName.hide();

            this.bringToBack();
            this.setStyle({
                weight: 1,
                opacity: .5
            });
        }

    </script>
</body>

</html>